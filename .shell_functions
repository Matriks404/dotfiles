backup_file ()
{
    cp "$1" "$1.bak"
}

restart_network_service ()
{
    if [ "$OS_NAME" = "Linux" ]; then
        sudo systemctl restart NetworkManager
    elif [ "$OS_NAME" = "OpenBSD" ]; then
        doas sh "/etc/netstart"
    fi
}

set_up_automatic_backup ()
{
    #TODO: Detect if there's already '/usr/local/scripts/backup_job.sh' and/or '/usr/local/scripts/backup_job_files'. If there is error out.
    #TODO: Also error out on `/etc/cron.daily/backup_job` existing.

    echo -e "Copying backup files to '/usr/local/scripts'..."
    sudo cp -v "$HOME/.local/scripts.noexecute/backup_job.sh" "/usr/local/scripts"
    sudo cp -rv "$HOME/.local/scripts.noexecute/backup_job_files" "/usr/local/scripts"

    #TODO: Add detection for other operating systems.
    if [ -f /etc/debian_version ]; then
        echo -e "Creating a daily cron job in '/etc/cron.daily'..."
        sudo ln -s "/usr/local/scripts/backup_job.sh" "/etc/cron.daily/backup_job"
    else
        echo -e "\nInfo: Unknown operating system. Make sure to add '/usr/local/scripts/backup_job.sh to your system-wide crontab for it to work without user interaction."
    fi

    echo -e "\nInfo: For backup system to work, you need to configure your includes, excludes, and settings over in '/usr/local/scripts/backup_job_files' first!"

    #TODO: Make it possible to do it here.

    echo -e "Also, if working over ssh and authentication is needed, you need to make sure you have neccesary keys (by using 'ssh-keygen') and you have copied it to your remote device (by using 'ssh-copy-id')."

    #TODO: Make it possible to do it here.
}

# Package updates / System upgrades

su_update_software ()
{
    if [ "$OS_NAME" = "Linux" ]; then
        sudo "$HOME/.local/bin/su-update-software.sh"
    elif [ "$OS_NAME" = "OpenBSD" ]; then
        doas "$HOME/.local/bin/su-update-software.sh"
    fi

    if [ "$OS_NAME" = "Linux" ]; then
        update_software
    fi
}

su_upgrade_system ()
{
    if [ "$OS_NAME" = "Linux" ]; then
        sudo "$HOME/.local/bin/su-upgrade-system.sh"
    elif [ "$OS_NAME" = "OpenBSD" ]; then
        doas "$HOME/.local/bin/su-upgrade-system.sh"
    fi
}

# Functions available only if git is installed
if [ "$(command -v git)" ]; then
    git_commit ()
    {
        local comment="$1"

        git add .
        git commit -m "$comment"
    }

    git_push ()
    {
        local comment="$1"

        git_commit "$comment"
        git push
    }
fi

# Linux-specific functions
if [ "$OS_NAME" = "Linux" ]; then
    # Functions specific to Flatpak (if it's installed)
    if [ "$(command -v flatpak)" ]; then
        # Document this function
        create_flatpak_symlinks ()
        {
            TARGET_DIR="$HOME/.local/bin/flatpak-executables"
            mkdir -p "$TARGET_DIR"

            declare -A CUSTOM_NAMES
            CUSTOM_NAMES=(
                ["net._86box._86Box"]="86box"
                ["org.telegram.desktop"]="telegram"
            )

            flatpak list --app --columns=application | while read -r app_id; do

                # Check if we have a custom name defined
                if [[ -n "${CUSTOM_NAMES[$app_id]}" ]]; then
                    script_name="${CUSTOM_NAMES[$app_id]}"
                else
                    # Default logic: get part after last dot and lowercase it
                    script_name=$(echo "$app_id" | awk -F. '{print $NF}' | tr '[:upper:]' '[:lower:]')

                    # Remove leading underscores (e.g., _86box -> 86box)
                    script_name="${script_name#_}"
                fi

                script_path="$TARGET_DIR/$script_name"

                cat <<EOF > "$script_path"
#!/bin/sh
flatpak run $app_id
EOF

                chmod +x "$script_path"
                echo -e "Mapped: $app_id -> $script_name"
            done

            echo -e "\nFinished! Scripts are in $TARGET_DIR"
        }
    fi

    # Functions specific to Tailscale (if it's installed)
    if [ "$(command -v tailscale)" ]; then
        restart_tailscaled_service ()
        {
            sudo systemctl restart tailscaled
        }

        restart_all_networks ()
        {
            restart_network_service
            restart_tailscaled_service
        }
    fi

    update_software ()
    {
        "$HOME/.local/bin/user-update-software.sh"
    }

    wiki ()
    {
        local article="$1"

        lynx gopher://gopherpedia.com/0/"${article}"
    }
fi
